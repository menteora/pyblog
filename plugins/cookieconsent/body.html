<script>console.log('CookieConsent body.html test log directly in plugin file.');</script>
<script src="https://cdn.jsdelivr.net/npm/cookieconsent@3/build/cookieconsent.min.js"></script>
<script>
try {
  document.addEventListener('DOMContentLoaded', function () {
    var cc = initCookieConsent();
    cc.run({
      guiOptions: {
        consentModal: { layout: 'cloud', position: 'bottom center' },
        preferencesModal: { layout: 'box' }
      },
      categories: {
        necessary: { enabled: true, readOnly: true },
        analytics: {}
      },
      onFirstAction: function(user_preferences, cookie){
        // if (cc.allowedCategory('analytics')) {
        //   loadAnalytics();
        // }
      },
      onAccept: function(cookie){
        // if (cc.allowedCategory('analytics')) {
        //   loadAnalytics();
        // }
      }
    });

    function loadAnalytics(){
      if (!window.ga_loaded){
        var s = document.createElement('script');
        s.src = 'https://www.googletagmanager.com/gtag/js?id={{ config.COOKIECONSENT_GA_ID }}';
        s.async = true;
        document.head.appendChild(s);
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', '{{ config.COOKIECONSENT_GA_ID }}');
        window.ga_loaded = true;
      }
    }
  });

} catch (error) {
  console.error("CookieConsent Initialization Error:", error);
}
</script>
