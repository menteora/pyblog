<script type="module">
  import 'https://cdn.jsdelivr.net/gh/orestbida/cookieconsent@3.1.0/dist/cookieconsent.umd.js';

  // Enable dark mode
  document.documentElement.classList.add('cc--darkmode');

  CookieConsent.run({
    guiOptions: {
        consentModal: {
            layout: "box",
            position: "bottom left",
            equalWeightButtons: true,
            flipButtons: false
        },
        preferencesModal: {
            layout: "box",
            position: "right",
            equalWeightButtons: true,
            flipButtons: false
        }
    },
    categories: {
        necessary: {
            readOnly: true
        },
        analytics: {} // Users can opt-in to this category
    },
    language: {
        default: "it",
        autoDetect: "browser",
        translations: {
            it: {
                consentModal: {
                    title: "Ciao viaggiatore, è tempo di biscotti!",
                    description: "Questo sito utilizza cookie per migliorare la tua esperienza. Accetta per continuare.",
                    acceptAllBtn: "Accetta tutto",
                    acceptNecessaryBtn: "Rifiuta tutto",
                    showPreferencesBtn: "Gestisci preferenze",
                    footer: '<a href="{{ base_url }}privacy-policy.html">Informativa sulla privacy</a><a href="{{ base_url }}terms-conditions.html">Termini e condizioni</a>'
                },
                preferencesModal: {
                    title: "Centro preferenze per il consenso",
                    acceptAllBtn: "Accetta tutto",
                    acceptNecessaryBtn: "Rifiuta tutto",
                    savePreferencesBtn: "Salva le preferenze",
                    closeIconLabel: "Chiudi la finestra",
                    serviceCounterLabel: "Servizi",
                    sections: [
                        {
                            title: "Utilizzo dei Cookie",
                            description: "Utilizziamo i cookie per personalizzare i contenuti, fornire funzionalità dei social media e analizzare il nostro traffico. Leggi la nostra informativa sulla privacy per maggiori dettagli."
                        },
                        {
                            title: "Cookie Strettamente Necessari <span class='pm__badge'>Sempre Attivati</span>",
                            description: "Questi cookie sono essenziali per il funzionamento del sito e non possono essere disattivati.",
                            linkedCategory: "necessary"
                        },
                        {
                            title: "Cookie Analitici",
                            description: "Questi cookie ci aiutano a capire come i visitatori interagiscono con il sito raccogliendo e riportando informazioni in modo anonimo.",
                            linkedCategory: "analytics"
                        },
                        {
                            title: "Ulteriori informazioni",
                            description: 'Per qualsiasi domanda in relazione alla mia politica sui cookie e alle tue scelte, per favore <a class="cc__link" href="{{ base_url }}contact.html">contattami</a>.'
                        }
                    ]
                }
            }
        }
    },
    // Example of how to handle analytics if the user opts in:
    onChange: function ({changedCategories, cookie}) {
      if (changedCategories.includes('analytics') && cookie.categories.includes('analytics')) {
        // Placeholder for analytics loading function if needed in the future
        // e.g., loadGoogleAnalytics();
        console.log('Analytics category consented.');
      }
    },
    onFirstConsent: function({cookie}){
        console.log('First consent action:', cookie);
        if(cookie.categories.includes('analytics')){
            console.log('Analytics consented on first action.');
        }
    }
  });
</script>
